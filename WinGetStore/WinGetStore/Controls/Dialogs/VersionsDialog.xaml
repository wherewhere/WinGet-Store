<ContentDialog
    x:Class="WinGetStore.Controls.Dialogs.VersionsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:WinGetStore.Controls"
    xmlns:converters="using:Microsoft.Toolkit.Uwp.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:deployment="using:Microsoft.Management.Deployment"
    xmlns:local="using:WinGetStore.Controls.Dialogs"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:viewmodels="using:WinGetStore.ViewModels"
    x:Uid="/VersionsDialog/VersionsDialog"
    d:DataContext="{d:DesignInstance Type=viewmodels:VersionsViewModel}"
    DataContext="{x:Bind Provider}"
    DefaultButton="Close"
    FullSizeDesired="True"
    Loaded="ContentDialog_Loaded"
    Style="{StaticResource DefaultContentDialogStyle}"
    mc:Ignorable="d">
    <ContentDialog.Resources>
        <converters:StringVisibilityConverter x:Key="StringVisibilityConverter" />
        <converters:CollectionVisibilityConverter x:Key="CollectionVisibilityConverter" />
    </ContentDialog.Resources>
    <Grid>
        <muxc:RefreshContainer RefreshRequested="RefreshContainer_RefreshRequested">
            <ListView
                x:Name="ListView"
                Padding="0,1.5"
                ItemsSource="{x:Bind Provider.PackageVersions, Mode=OneWay}">
                <ListView.ItemContainerStyle>
                    <Style BasedOn="{StaticResource TransparentCardItemStyle}" TargetType="ListViewItem">
                        <Setter Property="Margin" Value="0,1.5" />
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodels:CatalogPackageVersion">
                        <controls:SettingExpander Header="{x:Bind Version}" Icon="&#xECAA;">
                            <controls:SettingExpander
                                x:Uid="/VersionsDialog/Agreements"
                                Description="{x:Bind local:VersionsDialog.PackageAgreementsToDescription(PackageMetadata.Agreements)}"
                                ItemsSource="{Binding Tag, RelativeSource={RelativeSource Mode=Self}}"
                                Style="{StaticResource SettingExpanderExpanderItemStyle}"
                                Tag="{x:Bind local:VersionsDialog.PackageAgreementsToArray(PackageMetadata.Agreements)}"
                                Visibility="{Binding Tag, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource CollectionVisibilityConverter}}">
                                <controls:SettingExpander.ItemTemplate>
                                    <DataTemplate x:DataType="deployment:PackageAgreement">
                                        <controls:Setting
                                            ActionIcon="&#xE8A7;"
                                            Click="HyperlinkButton_Click"
                                            Header="{x:Bind Label}"
                                            IsClickEnabled="{x:Bind Url, Converter={StaticResource StringToBoolConverter}}"
                                            Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                            Tag="{x:Bind Url}">
                                            <controls:Setting.Description>
                                                <TextBlock
                                                    IsTextSelectionEnabled="True"
                                                    Text="{x:Bind Text}"
                                                    ToolTipService.ToolTip="{x:Bind Url}"
                                                    Visibility="{x:Bind Text, Converter={StaticResource StringVisibilityConverter}}" />
                                            </controls:Setting.Description>
                                        </controls:Setting>
                                    </DataTemplate>
                                </controls:SettingExpander.ItemTemplate>
                            </controls:SettingExpander>
                            <controls:Setting
                                x:Name="Author"
                                x:Uid="/VersionsDialog/Author"
                                x:Load="{x:Bind PackageMetadata.Author, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.Author}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="Copyright"
                                x:Uid="/VersionsDialog/Copyright"
                                x:Load="{x:Bind PackageMetadata.Copyright, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.Copyright}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="CopyrightUrl"
                                x:Uid="/VersionsDialog/CopyrightUrl"
                                x:Load="{x:Bind PackageMetadata.CopyrightUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.CopyrightUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.CopyrightUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="Description"
                                x:Uid="/VersionsDialog/Description"
                                x:Load="{x:Bind PackageMetadata.Description, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.Description}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:SettingExpander
                                x:Uid="/VersionsDialog/Documentations"
                                Description="{x:Bind local:VersionsDialog.DocumentationsToDescription(PackageMetadata.Documentations)}"
                                ItemsSource="{Binding Tag, RelativeSource={RelativeSource Mode=Self}}"
                                Style="{StaticResource SettingExpanderExpanderItemStyle}"
                                Tag="{x:Bind local:VersionsDialog.DocumentationsToArray(PackageMetadata.Documentations)}"
                                Visibility="{Binding Tag, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource CollectionVisibilityConverter}}">
                                <controls:SettingExpander.ItemTemplate>
                                    <DataTemplate x:DataType="deployment:Documentation">
                                        <controls:Setting
                                            ActionIcon="&#xE8A7;"
                                            Click="HyperlinkButton_Click"
                                            Header="{x:Bind DocumentLabel}"
                                            IsClickEnabled="{x:Bind DocumentUrl, Converter={StaticResource StringToBoolConverter}}"
                                            Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                            Tag="{x:Bind DocumentUrl}">
                                            <controls:Setting.Description>
                                                <TextBlock
                                                    IsTextSelectionEnabled="True"
                                                    Text="{x:Bind DocumentUrl}"
                                                    Visibility="{x:Bind DocumentUrl, Converter={StaticResource StringVisibilityConverter}}" />
                                            </controls:Setting.Description>
                                        </controls:Setting>
                                    </DataTemplate>
                                </controls:SettingExpander.ItemTemplate>
                            </controls:SettingExpander>
                            <controls:SettingExpander
                                x:Uid="/VersionsDialog/Icons"
                                Description="{x:Bind local:VersionsDialog.IconsToDescription(PackageMetadata.Icons)}"
                                ItemsSource="{Binding Tag, RelativeSource={RelativeSource Mode=Self}}"
                                Style="{StaticResource SettingExpanderExpanderItemStyle}"
                                Tag="{x:Bind local:VersionsDialog.IconsToArray(PackageMetadata.Icons)}"
                                Visibility="{Binding Tag, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource CollectionVisibilityConverter}}">
                                <controls:SettingExpander.ItemTemplate>
                                    <DataTemplate x:DataType="deployment:Icon">
                                        <controls:Setting
                                            ActionIcon="&#xE8A7;"
                                            Click="HyperlinkButton_Click"
                                            Header="{x:Bind FileType}"
                                            IsClickEnabled="{x:Bind Url, Converter={StaticResource StringToBoolConverter}}"
                                            Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                            Tag="{x:Bind Url}">
                                            <controls:Setting.Description>
                                                <TextBlock IsTextSelectionEnabled="True">
                                                    <Run Text="{x:Bind Theme}" />
                                                    <Run Text="•" />
                                                    <Run Text="{x:Bind Resolution}" />
                                                </TextBlock>
                                            </controls:Setting.Description>
                                        </controls:Setting>
                                    </DataTemplate>
                                </controls:SettingExpander.ItemTemplate>
                            </controls:SettingExpander>
                            <controls:Setting
                                x:Name="InstallationNotes"
                                x:Uid="/VersionsDialog/InstallationNotes"
                                x:Load="{x:Bind PackageMetadata.InstallationNotes, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.InstallationNotes}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="License"
                                x:Uid="/VersionsDialog/License"
                                x:Load="{x:Bind PackageMetadata.License, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.License}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="LicenseUrl"
                                x:Uid="/VersionsDialog/LicenseUrl"
                                x:Load="{x:Bind PackageMetadata.LicenseUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.LicenseUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.LicenseUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="Locale"
                                x:Uid="/VersionsDialog/Locale"
                                x:Load="{x:Bind PackageMetadata.Locale, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.Locale}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="PackageName"
                                x:Uid="/VersionsDialog/PackageName"
                                x:Load="{x:Bind PackageMetadata.PackageName, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.PackageName}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="PackageUrl"
                                x:Uid="/VersionsDialog/PackageUrl"
                                x:Load="{x:Bind PackageMetadata.PackageUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.PackageUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.PackageUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="PrivacyUrl"
                                x:Uid="/VersionsDialog/PrivacyUrl"
                                x:Load="{x:Bind PackageMetadata.PrivacyUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.PrivacyUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.PrivacyUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="Publisher"
                                x:Uid="/VersionsDialog/Publisher"
                                x:Load="{x:Bind PackageMetadata.Publisher, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.Publisher}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="PublisherSupportUrl"
                                x:Uid="/VersionsDialog/PublisherSupportUrl"
                                x:Load="{x:Bind PackageMetadata.PublisherSupportUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.PublisherSupportUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.PublisherSupportUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="PublisherUrl"
                                x:Uid="/VersionsDialog/PublisherUrl"
                                x:Load="{x:Bind PackageMetadata.PublisherUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.PublisherUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.PublisherUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="PurchaseUrl"
                                x:Uid="/VersionsDialog/PurchaseUrl"
                                x:Load="{x:Bind PackageMetadata.PurchaseUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.PurchaseUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.PurchaseUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="ReleaseNotes"
                                x:Uid="/VersionsDialog/ReleaseNotes"
                                x:Load="{x:Bind PackageMetadata.ReleaseNotes, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.ReleaseNotes}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="ReleaseNotesUrl"
                                x:Uid="/VersionsDialog/ReleaseNotesUrl"
                                x:Load="{x:Bind PackageMetadata.ReleaseNotesUrl, Converter={StaticResource StringToBoolConverter}}"
                                ActionIcon="&#xE8A7;"
                                Click="HyperlinkButton_Click"
                                IsClickEnabled="True"
                                Style="{StaticResource ClickableSettingExpanderItemStyle}"
                                Tag="{x:Bind PackageMetadata.ReleaseNotesUrl}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.ReleaseNotesUrl}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Name="ShortDescription"
                                x:Uid="/VersionsDialog/ShortDescription"
                                x:Load="{x:Bind PackageMetadata.ShortDescription, Converter={StaticResource StringToBoolConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind PackageMetadata.ShortDescription}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                            <controls:Setting
                                x:Uid="/VersionsDialog/Tags"
                                CornerRadius="{Binding Source={StaticResource ControlCornerRadius}, Converter={StaticResource BottomCornerRadiusFilterConverter}}"
                                Style="{StaticResource DefaultSettingExpanderItemStyle}"
                                Tag="{x:Bind local:VersionsDialog.TagsToArray(PackageMetadata.Tags)}"
                                Visibility="{Binding Tag, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource CollectionVisibilityConverter}}">
                                <controls:Setting.Description>
                                    <TextBlock IsTextSelectionEnabled="True" Text="{x:Bind local:VersionsDialog.JoinTags(', ', PackageMetadata.Tags)}" />
                                </controls:Setting.Description>
                            </controls:Setting>
                        </controls:SettingExpander>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </muxc:RefreshContainer>
        <muxc:ProgressBar
            x:Name="ProgressBar"
            Margin="1,0"
            VerticalAlignment="Top"
            x:Load="{x:Bind Provider.PackageVersions.IsLoading, Mode=OneWay}"
            Background="{ThemeResource SystemControlTransparentBrush}"
            IsIndeterminate="{x:Bind Provider.PackageVersions.IsLoading, Mode=OneWay}">
            <muxc:ProgressBar.RenderTransform>
                <TranslateTransform Y="-6" />
            </muxc:ProgressBar.RenderTransform>
        </muxc:ProgressBar>
    </Grid>
</ContentDialog>
